<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>House Of Tara — Offline Inventory & POS</title>
  <!-- FIX: relative path to manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7b3f98">

  <style>
    :root{--accent:#7b3f98;--muted:#666}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:#f6f6f8;color:#222}
    header{background:var(--accent);color:white;padding:12px 18px;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0}
    main{padding:18px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tabs button{background:white;border-radius:8px;padding:8px 12px;border:1px solid rgba(0,0,0,0.08);cursor:pointer}
    .card{background:white;padding:14px;border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,0.06);margin-top:12px}
    form .row{display:flex;gap:8px;flex-wrap:wrap}
    label{font-size:13px;color:var(--muted)}
    input,select,button{padding:8px;border-radius:6px;border:1px solid #ddd}
    table{width:100%;border-collapse:collapse}
    table th,table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.secondary{background:#eee;color:#222}
    .right{margin-left:auto}
    @media print{ header, .tabs, .btn, .controls{display:none} .label{border:1px solid #000} }
    .label-sheet{width:210mm;height:297mm;padding:12mm;box-sizing:border-box}
    .label-grid{display:grid;grid-template-columns:repeat(4,1fr);grid-auto-rows:1fr;gap:6mm}
    .label-cell{border:1px dashed transparent;padding:4mm;display:flex;flex-direction:column;justify-content:center;align-items:center}
    .barcode-canvas{width:100%;height:28mm}
    .sale-rows{display:flex;flex-direction:column;gap:6px}
    .sale-row{display:flex;gap:6px;align-items:center}
    .sale-row input{flex:1}
  </style>
</head>
<body>
  <header>
    <h1>House Of Tara — Offline Inventory & POS</h1>
    <div class="right small">Offline — data stored locally in your browser (IndexedDB)</div>
  </header>

  <main>
    <div class="tabs">
      <button id="tab-inventory">Add Inventory</button>
      <button id="tab-check">Check Inventory</button>
      <button id="tab-sale">Sale</button>
      <button id="tab-viewsales">View Sales</button>
      <button id="tab-labels">Labels</button>
      <button id="tab-data">Data</button>
    </div>

    <!-- Inventory Section -->
    <section id="section-inventory" class="card">
      <h3>Add / Edit Inventory</h3>
      <form id="form-inv">
        <div class="row">
          <div style="flex:1">
            <label>Product Name</label><br>
            <input id="p-name" required />
          </div>
          <div style="width:160px">
            <label>SKU</label><br>
            <input id="p-sku" required />
          </div>
          <div style="width:120px">
            <label>Cost Price</label><br>
            <input id="p-cost" type="number" step="0.01" required />
          </div>
          <div style="width:120px">
            <label>Selling Price</label><br>
            <input id="p-sell" type="number" step="0.01" required />
          </div>
          <div style="width:100px">
            <label>Stock</label><br>
            <input id="p-stock" type="number" step="1" value="0" required />
          </div>
        </div>
        <div class="controls">
          <button class="btn" type="submit">Save Item</button>
          <button class="btn secondary" type="button" id="inv-clear">Clear Form</button>
        </div>
      </form>
      <div class="card" style="margin-top:12px">
        <h4>Inventory List (select to add to label)</h4>
        <div id="inv-list"></div>
      </div>
    </section>

    <!-- Other sections (Check, Sale, View Sales, Labels, Data) -->
    <section id="section-check" class="card" style="display:none">
      <h3>Check Inventory</h3>
      <label>Search by Name or SKU</label><br>
      <input id="search-inv" placeholder="Type name or SKU" style="width:100%;margin-top:6px" />
      <div class="card" style="margin-top:12px">
        <table id="table-check"><thead><tr><th>SKU</th><th>Name</th><th>Stock</th><th>Cost</th><th>Selling</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <section id="section-sale" class="card" style="display:none">
      <h3>Sale / POS</h3>
      <label>Customer Name</label><br>
      <input id="sale-cust" placeholder="Customer name (optional)" style="width:100%;margin-top:6px" />
      <div class="card" style="margin-top:10px">
        <div class="sale-rows" id="sale-rows"></div>
        <div class="controls">
          <button class="btn" id="add-sale-row" type="button">Add Product Row</button>
          <button class="btn secondary" id="clear-sale" type="button">Clear Rows</button>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <div style="font-weight:600">Total: ₹ <span id="sale-total">0.00</span></div>
          <div class="right">
            <button class="btn" id="submit-sale">Submit Sale (Save & Print Bill)</button>
          </div>
        </div>
      </div>
    </section>

    <section id="section-viewsales" class="card" style="display:none">
      <h3>View Sales</h3>
      <div id="sales-list"></div>
    </section>

    <section id="section-labels" class="card" style="display:none">
      <h3>Labels</h3>
      <div id="labels-output"></div>
    </section>

    <section id="section-data" class="card" style="display:none">
      <h3>Data — Export / Import / Migrate</h3>
      <div id="data-msg"></div>
    </section>
  </main>

  <!-- Install button -->
  <button id="install-btn" style="position:fixed;right:16px;bottom:16px;padding:10px 14px;border-radius:10px;background:#7b3f98;color:#fff;border:none;display:none;z-index:9999;">Install App</button>

  <script>
    // Service worker registration — FIXED path
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(()=>console.log('SW registered'))
        .catch(e=>console.warn('SW failed', e));
    }

    // Install button logic
    let deferredPrompt = null;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });

    installBtn.addEventListener('click', async () => {
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      console.log('User choice:', choice.outcome);
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    window.addEventListener('appinstalled', () => {
      console.log('App installed');
      installBtn.style.display = 'none';
    });
  </script>
</body>
</html>
